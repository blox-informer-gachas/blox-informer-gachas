<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="robots" content="noindex, nofollow" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=no">
    <title>Abyss (Roblox) Interactive Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',sans-serif; color:#e6e6e6;}
        body{background:#0f172a; overflow:hidden; display:flex; justify-content:center; align-items:center; min-height:100vh;}
        body, #map-wrapper, #map-container, #map, .map-background, .map-marker, .map-zone {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        button { -webkit-tap-highlight-color:transparent; -webkit-touch-callout:none; touch-action:manipulation; }
        #map-wrapper {
            max-width: 100%;
            overflow: hidden;
            box-shadow: 0 12px 30px rgba(0,0,0,0.6);
        }
        #map-container {
            width: 2560px;
            height: 2277px;
            position: relative;
            overflow: hidden;
            background: #0f172a;
        }
        #map {
            width: 100%;
            height: 100%;
            position: relative;
            transform-origin: 0 0;
            transition: transform 0.1s ease-out;
            cursor: grab;
        }
        #map:active { cursor: grabbing; }
        .map-background{position:absolute; top:0; left:0; width:100%; height:100%; object-fit:fill; pointer-events:none;}
        .map-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 2000;
        }
        .control-btn{
            width:44px; height:44px; background:#1e293b; border:2px solid #334155; border-radius:10px; color:#e6e6e6; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.2rem; transition:0.2s;
        }
        .control-btn:hover{background:#4cc9f0; color:#0f172a; transform:scale(1.05);}
        .filter-panel{position:fixed; top:20px; left:20px; background:#1e293be0; backdrop-filter:blur(8px); width:240px; border-radius:12px; padding:16px; z-index:1000; border:2px solid #334155; max-height:80vh; overflow:hidden; transition:max-height 0.4s;}
        .filter-panel.collapsed{max-height:68px;}
        .filter-panel-content{opacity:1; transition:0.4s;}
        .filter-panel.collapsed .filter-panel-content{opacity:0; pointer-events:none;}
        .quick-filter-buttons{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:10px;}
        .quick-filter-btn{transition: all 0.2s; background:#0f172a; border:1px solid #334155; padding:8px; border-radius:6px; color:#e6e6e6; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:6px;}
        .quick-filter-btn:hover{background:#1c2635; border-color: #4cc9f0; transition: all 0.2s;}
        .search-filter{position:relative; margin-bottom:5px;}
        .search-filter input:hover{ border-color: #4cc9f0; transition: all 0.2s;}
        .search-filter input{ transition: all 0.2s; width:100%; padding:10px 10px 10px 36px; background:#0f172a; border:1px solid #334155; border-radius:6px; color:#e6e6e6;}
        .search-filter input:focus{outline:none; border-color: #4cc9f0;}
        .search-filter i{position:absolute; left:12px; top:12px; color:#94a3b8;}
        #filter-list{max-height:calc(80vh - 240px); overflow-y:auto; padding-right:4px;}
        .filter-group-header{padding-right: 5px;display:flex; align-items:center; justify-content:space-between; margin:10px 0 8px; padding-bottom:4px; border-bottom:1px solid #334155; color:#4cc9f0; font-weight:600;}
        .filter-group-toggle{font-size: 0.9rem;display:flex; align-items:center; gap:6px; cursor:pointer; flex:1;}
        .group-toggle-switch{width:40px; height:18px; background:#2c3e50; border-radius:12px; position:relative; cursor:pointer; transition:0.2s;}
        .group-toggle-switch.on{background:#4cc9f0;}
        .group-toggle-switch .slider{width:14px; height:14px; background:white; border-radius:50%; position:absolute; top:2px; left:2px; transition:left 0.2s;}
        .group-toggle-switch.on .slider{left:24px;}
        .filter-group-content{padding-right: 5px; max-height:500px; overflow:hidden; transition:max-height 0.4s, opacity 0.4s;}
        .filter-group-content.collapsed{max-height:0; opacity:0;}
        .filter-category-item{font-size: 0.85rem;display:flex; border: 1px solid transparent; align-items:center; justify-content:space-between; background:#0f172a; padding:8px 12px; margin-bottom:6px; border-radius:6px; cursor:pointer; transition:0.2s; opacity:0.5;}
        .filter-category-item:hover{background:#1c2635; border-color: #4cc9f0;}
        .filter-category-item.active{opacity:1;}
        .filter-category-item.active:hover{background:#1c2635;}
        .filter-category-left{display:flex; align-items:center; gap:10px;}
        .filter-color{width:18px; height:18px; border-radius:4px;}
        .filter-category-count{color:#94a3b8;}
        .map-marker{position:absolute; transform:translate(-50%,-100%); cursor:pointer; transition:0.15s; z-index:10; max-width:80px; max-height:80px; display:flex; align-items:center; justify-content:center; -webkit-tap-highlight-color:transparent; -webkit-touch-callout:none; touch-action:manipulation;}
        .map-marker img{width:100%; height:100%; object-fit:contain; pointer-events:none;}
        .map-marker:hover{transform:translate(-50%,-100%) scale(1.15); filter:drop-shadow(0 0 8px currentColor);}
        .map-marker.completed{opacity:0.4}
        .hover-tooltip{position:fixed; background:#1e293b; border:1px solid #4cc9f0; border-radius:8px; padding:6px 12px; color:#e6e6e6; font-size:0.85rem; pointer-events:none; z-index:999; white-space:nowrap; display:none; box-shadow:0 4px 12px rgba(0,0,0,0.5);}
        .map-zone{position:absolute; border-width:2px; border-style:solid; cursor:pointer; transition:0.2s; z-index:5; background-size:cover; background-repeat:no-repeat; background-position:center; -webkit-tap-highlight-color:transparent; -webkit-touch-callout:none; touch-action:manipulation;}
        .map-zone:hover{opacity:0.9 !important; box-shadow:0 0 18px rgba(255,255,255,0.2);}
        .tooltip{position:fixed; background:#0f172a; border:2px solid #4cc9f0; border-radius:16px; padding:20px; width:340px; max-width:90vw; max-height:80vh; overflow-y:auto; z-index:2000; display:none; box-shadow:0 20px 40px rgba(0,0,0,0.8); backdrop-filter:blur(4px); color:#e2e8f0; line-height:1.6;}
        .tooltip h3{color:#4cc9f0; margin-bottom:10px; border-bottom:1px solid #334155; padding-bottom:8px;}
        .tooltip p{color:#cbd5e1; font-size:0.95rem;}
        .tooltip-img{max-width:100%; max-height:160px; object-fit:contain; border-radius:12px; margin:15px 0; display:block; margin-left:auto; margin-right:auto; border:2px solid #334155;}
        .tooltip-close{position:absolute; top:12px; right:16px; background:none; border:none; color:#94a3b8; font-size:1.6rem; cursor:pointer; transition:0.2s;}
        .tooltip-close:hover{color:#4cc9f0; transform:scale(1.2);}
        .tooltip-close.closing{pointer-events:none;}
        .completion-checkbox{transition: all 0.2s;border: 1px solid transparent; margin:16px 0 8px; display:flex; align-items:center; gap:10px; background:#1e293b; padding:10px 14px; border-radius:8px;}
        .completion-checkbox:hover{transition: all 0.2s;border-color: #4cc9f0;}
        .completion-checkbox input{width:18px; height:18px; accent-color:#4cc9f0;}
        .search-match{opacity:1 !important;}
        .search-mismatch{opacity:0.2 !important; pointer-events:none;}
        .filter-hidden{display:none !important;}
        .map-element-hidden{opacity: 0 !important; pointer-events: none !important;}
        @keyframes tooltipFadeIn{from{opacity:0;} to{opacity:1;}}
        @keyframes tooltipFadeOut{from{opacity:1;} to{opacity:0;}}
        .tooltip.fade-in{animation:tooltipFadeIn 0.3s ease-out forwards;}
        .tooltip.fade-out{animation:tooltipFadeOut 0.3s ease-out forwards;}
        #filter-list::-webkit-scrollbar{width:8px;}
        #filter-list::-webkit-scrollbar-track{background:#0f172a;}
        #filter-list::-webkit-scrollbar-thumb{background:#4cc9f0; border-radius:4px;}
        #filter-list::-webkit-scrollbar-thumb:hover{background:#4cc9f0e6;}
        #filter-list{scrollbar-color:#4cc9f0 #0f172a; scrollbar-width:thin;}
    </style>
</head>
<body>
    <div id="map-wrapper">
        <div id="map-container">
            <div id="map">
                <img src="https://bloxinformer.com/wp-content/uploads/2026/02/abyss-map-release-roblox-scaled.webp" class="map-background">
            </div>
            <div class="filter-panel">
                <div class="filter-header" style="display:flex; justify-content:space-between; margin-bottom:12px;">
                    <h3 style="color:#4cc9f0;"><i class="fas fa-filter"></i> Filters</h3>
                    <button class="control-btn" style="width:32px;height:32px;" onclick="toggleFilters()"><i class="fas fa-chevron-up"></i></button>
                </div>
                <div class="filter-panel-content">
                    <div class="quick-filter-buttons">
                        <button class="quick-filter-btn" onclick="showAllMarkers()">Show all markers</button>
                        <button class="quick-filter-btn" onclick="hideAllMarkers()">Hide all markers</button>
                        <button class="quick-filter-btn" onclick="showAllZones()">Show all zones</button>
                        <button class="quick-filter-btn" onclick="hideAllZones()">Hide all zones</button>
                    </div>
                    <div class="search-filter">
                        <input type="text" id="filter-search" placeholder="Search name, category..." oninput="searchElements()">
                        <i class="fas fa-search"></i>
                    </div>
                    <div id="filter-list"><div class="filter-group-header" data-group="Collectables">
            <div class="filter-group-toggle" onclick="toggleGroup('Collectables')">
                <i class="fas fa-gift" style="margin-right:6px;"></i> Collectables <span class="group-count">(7)</span>
            </div>
            <div class="group-toggle-switch on" onclick="event.stopPropagation();toggleGroupVisibility('Collectables')"><span class="slider"></span></div>
        </div>
        <div class="filter-group-content" id="group-Collectables"><div class="filter-category-item" data-category="Chests" data-group="Collectables" onclick="toggleCategory('Chests')">
                <div class="filter-category-left"><i class="fas fa-box" style="margin-right:8px;"></i> <span class="filter-category-name">Chests</span></div>
                <div class="filter-category-right"><span class="filter-category-count">(7)</span></div>
            </div></div><div class="filter-group-header" data-group="Hidden Areas">
            <div class="filter-group-toggle" onclick="toggleGroup('Hidden Areas')">
                <i class="fas fa-key" style="margin-right:6px;"></i> Hidden Areas <span class="group-count">(2)</span>
            </div>
            <div class="group-toggle-switch on" onclick="event.stopPropagation();toggleGroupVisibility('Hidden Areas')"><span class="slider"></span></div>
        </div>
        <div class="filter-group-content" id="group-Hidden-Areas"><div class="filter-category-item" data-category="Morveth's Cave" data-group="Hidden Areas" onclick="toggleCategory('Morveth\'s Cave')">
                <div class="filter-category-left"><i class="fas fa-dungeon" style="margin-right:8px;"></i> <span class="filter-category-name">Morveth's Cave</span></div>
                <div class="filter-category-right"><span class="filter-category-count">(1)</span></div>
            </div><div class="filter-category-item" data-category="Angler Cave" data-group="Hidden Areas" onclick="toggleCategory('Angler Cave')">
                <div class="filter-category-left"><i class="fas fa-dungeon" style="margin-right:8px;"></i> <span class="filter-category-name">Angler Cave</span></div>
                <div class="filter-category-right"><span class="filter-category-count">(1)</span></div>
            </div></div><div class="filter-group-header" data-group="Misc">
            <div class="filter-group-toggle" onclick="toggleGroup('Misc')">
                <i class="fas fa-asterisk" style="margin-right:6px;"></i> Misc <span class="group-count">(24)</span>
            </div>
            <div class="group-toggle-switch on" onclick="event.stopPropagation();toggleGroupVisibility('Misc')"><span class="slider"></span></div>
        </div>
        <div class="filter-group-content" id="group-Misc"><div class="filter-category-item" data-category="NPCs" data-group="Misc" onclick="toggleCategory('NPCs')">
                <div class="filter-category-left"><i class="fas fa-user" style="margin-right:8px;"></i> <span class="filter-category-name">NPCs</span></div>
                <div class="filter-category-right"><span class="filter-category-count">(24)</span></div>
            </div></div></div>
                </div>
            </div>
        </div>
    </div>
    <div class="map-controls">
        <button class="control-btn" onclick="zoomIn()"><i class="fas fa-search-plus"></i></button>
        <button class="control-btn" onclick="zoomOut()"><i class="fas fa-search-minus"></i></button>
        <button class="control-btn" onclick="resetView()"><i class="fas fa-expand-arrows-alt"></i></button>
    </div>
    <div class="hover-tooltip" id="hover-tooltip"></div>
    <div class="tooltip" id="tooltip"></div>
    <script>
        const mapElements = [{"id":1770820293339,"type":"marker","shape":"marker","x":1115.6420233463036,"y":1192.081181850158,"width":0,"height":0,"name":"Crab","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Crab-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Crab-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820367540,"type":"marker","shape":"marker","x":1124.2749675745786,"y":1198.488498065424,"width":0,"height":0,"name":"Henry","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Henry-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Henry-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820432392,"type":"marker","shape":"marker","x":1063.8443579766538,"y":1218.351178332747,"width":0,"height":0,"name":"David","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/David-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/David-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820473502,"type":"marker","shape":"marker","x":1073.473411154345,"y":1231.8065423848045,"width":0,"height":0,"name":"Virelia","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Virelia-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Virelia-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820520500,"type":"marker","shape":"marker","x":1118.2983138780805,"y":1215.788251846641,"width":0,"height":0,"name":"MrBlack","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/MrBlack.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"groupIcon":"fas fa-asterisk","categoryIcon":"fas fa-user","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/MrBlack.png","tooltipImage":""},{"id":1770820608736,"type":"marker","shape":"marker","x":1102.194552529183,"y":1231.9266795638412,"width":0,"height":0,"name":"Billy","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Billy-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Billy-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820649702,"type":"marker","shape":"marker","x":1113.483787289235,"y":1225.1989975378121,"width":0,"height":0,"name":"Scientist","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Scientist-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Scientist-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820684020,"type":"marker","shape":"marker","x":916.4202334630351,"y":1027.4131551178332,"width":0,"height":0,"name":"Diver","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Diver.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Diver.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820719722,"type":"marker","shape":"marker","x":1024.5523248305697,"y":814.4494217903389,"width":0,"height":0,"name":"Morveth","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Morveth-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Morveth-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820762160,"type":"marker","shape":"marker","x":526.1660079051385,"y":1196.8866690116074,"width":0,"height":0,"name":"Jeff","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Jeff-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Jeff-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820762880,"type":"marker","shape":"marker","x":597.4993514915693,"y":1199.2493668659865,"width":0,"height":0,"name":"Marcus","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Marcus-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Marcus-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770820848332,"type":"marker","shape":"marker","x":293.3540856031128,"y":1359.1119064368625,"width":0,"height":0,"name":"Hank","description":"","image":"https://bloxinformer.com/wp-content/uploads/2026/02/Grumpy-Hank-1.png","category":"NPCs","group":"Misc","categoryImage":"","groupImage":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100,"mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Grumpy-Hank-1.png","tooltipImage":"","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk"},{"id":1770892724196,"type":"marker","x":1543.6602316602316,"y":1205.8569117129794,"width":0,"height":0,"name":"Lost Captain","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Lost-Captain-1.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770892753346,"type":"marker","x":1617.7915057915059,"y":594.5989447766443,"width":0,"height":0,"name":"Lumi","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Lumi-1.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770892798729,"type":"marker","x":1644.4787644787643,"y":558.7179739711572,"width":0,"height":0,"name":"Isolde","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Isolde-1.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770892814808,"type":"marker","x":1614.3320463320465,"y":352.4023918396061,"width":0,"height":0,"name":"Golem","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Golemn-Icon.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770892817824,"type":"marker","x":1699.976520866586,"y":538.3107755964206,"width":0,"height":0,"name":"Victor","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Victor-1.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770892896636,"type":"marker","x":380.5405405405406,"y":1123.0601477312698,"width":0,"height":0,"name":"Suspicious Fisher","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Suspicious-Fisher-1.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770899344334,"type":"marker","x":1057.8532818532817,"y":1173.179599015125,"width":0,"height":0,"name":"Richard","description":"Allows you to view your Bestiary. Sells the Radar item for $450.","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Richard-1.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"fas fa-user","groupIcon":"fas fa-asterisk","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770901230928,"type":"zone","shape":"circle","x":875.9007162377475,"y":655.725672638465,"width":307.2,"height":182.16,"name":"Morveth's Cave","description":"Secluded area where Morveth NPC resides.","mapImage":"","tooltipImage":"","category":"Morveth's Cave","group":"Hidden Areas","categoryIcon":"fas fa-dungeon","groupIcon":"fas fa-key","color":"#6bb46a","opacity":75,"borderStyle":"solid","size":20},{"id":1770902290083,"type":"zone","shape":"circle","x":1433.6347716921694,"y":996.8723669926043,"width":307.2,"height":182.16,"name":"Angler Cave","description":"Secret area unlocked after completing Lost Captain's quests.","mapImage":"","tooltipImage":"","category":"Angler Cave","group":"Hidden Areas","categoryIcon":"fas fa-dungeon","groupIcon":"fas fa-key","color":"#6bb46a","opacity":75,"borderStyle":"solid","size":20},{"id":1770903461906,"type":"marker","x":1087.0489241416083,"y":1186.0051958105175,"width":0,"height":0,"name":"Kraken","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Kraken.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770903653153,"type":"marker","x":988.4359921674793,"y":1294.437845656173,"width":0,"height":0,"name":"Bob","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/BOB.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770903795609,"type":"marker","x":1581.7362829085691,"y":1142.2193129595946,"width":0,"height":0,"name":"Lightkeeper","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/LightKeeper.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770903833567,"type":"marker","x":1755.8559433506118,"y":470.2816734604427,"width":0,"height":0,"name":"Isaac","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Isaac.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770903874413,"type":"marker","x":1699.868125541274,"y":278.665566260345,"width":0,"height":0,"name":"King Cat","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/KingCat.png","tooltipImage":"","category":"NPCs","group":"Misc","categoryIcon":"","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770907316211,"type":"marker","x":1120.1235521235521,"y":1182.7905733380233,"width":0,"height":0,"name":"Treasure Chest","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Chests-1.png","tooltipImage":"https://bloxinformer.com/wp-content/uploads/2026/02/ches1-forgotten-deep-abyss.png","category":"Chests","group":"Collectables","categoryIcon":"fas fa-box","groupIcon":"fas fa-gift","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770907484931,"type":"marker","x":1061.250353128425,"y":1213.4745008499995,"width":0,"height":0,"name":"Treasure Chest","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Chests-1.png","tooltipImage":"https://bloxinformer.com/wp-content/uploads/2026/02/chest2-forgotten-deep-abyss.png","category":"Chests","group":"Collectables","categoryIcon":"fas fa-box","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770908738414,"type":"marker","x":1119.6293436293436,"y":1209.060569820612,"width":0,"height":0,"name":"Treasure Chest","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Chests-1.png","tooltipImage":"https://bloxinformer.com/wp-content/uploads/2026/02/chest3-forgotten-lands-abyss.png","category":"Chests","group":"Collectables","categoryIcon":"fas fa-box","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770908813473,"type":"marker","x":1037.096525096525,"y":1251.3488568413647,"width":0,"height":0,"name":"Treasure Chest","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Chests-1.png","tooltipImage":"https://bloxinformer.com/wp-content/uploads/2026/02/chest4-forgotten-deep-abyss.png","category":"Chests","group":"Collectables","categoryIcon":"fas fa-box","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770908907252,"type":"marker","x":1045.31942752733,"y":1022.2538604444634,"width":0,"height":0,"name":"Treasure Chest","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Chests-1.png","tooltipImage":"https://bloxinformer.com/wp-content/uploads/2026/02/chest5-forgotten-deep-abyss.png","category":"Chests","group":"Collectables","categoryIcon":"fas fa-box","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770908950291,"type":"marker","x":1261.352743079594,"y":1145.4228709133763,"width":0,"height":0,"name":"Treasure Chest","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Chests-1.png","tooltipImage":"https://bloxinformer.com/wp-content/uploads/2026/02/chest6-forgotten-deep-abyss.png","category":"Chests","group":"Collectables","categoryIcon":"fas fa-box","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100},{"id":1770909019728,"type":"marker","x":1022.2702702702702,"y":1165.4908195568064,"width":0,"height":0,"name":"Treasure Chest","description":"","mapImage":"https://bloxinformer.com/wp-content/uploads/2026/02/Chests-1.png","tooltipImage":"https://bloxinformer.com/wp-content/uploads/2026/02/chest7-forgotten-deep-abyss.png","category":"Chests","group":"Collectables","categoryIcon":"fas fa-box","groupIcon":"","color":"#4cc9f0","opacity":100,"borderStyle":"solid","icon":"map-marker-alt","size":100}];
        const bgWidth = 2560, bgHeight = 2277;
        const minZoom = 0.4, maxZoom = 2.5;
        let zoom = 0.4, offsetX = 0, offsetY = 0, isDragging = false, dragStart = {x:0,y:0};
        let completedMarkers = JSON.parse(localStorage.getItem('mapforge_completed_markers')||'{}');
        let groupVisibility = {};

        window.onload = ()=>{
            mapElements.forEach(el => {
                if(el.type==='marker') createMarker(el);
                else createZone(el);
            });
            document.querySelectorAll('.filter-group-header').forEach(h=>{
                let g = h.dataset.group;
                groupVisibility[g] = true;
            });
            document.querySelectorAll('.filter-category-item').forEach(item => {
                item.classList.add('active');
            });
            setupTouchPan();
            centerMapOnLoad();
            const closeTooltipHandler = function(e) {
                const tooltip = document.getElementById('tooltip');
                if (tooltip.style.display === 'block' && 
                    !tooltip.contains(e.target) && 
                    !e.target.closest('.map-marker') && 
                    !e.target.closest('.map-zone')) {
                    closeTooltip();
                }
            };
            document.addEventListener('click', closeTooltipHandler);
            document.addEventListener('touchend', closeTooltipHandler);
        };

        function createMarker(el){
            let m = document.createElement('div');
            m.className = 'map-marker filter-'+el.category;
            if(completedMarkers[el.id]) m.classList.add('completed');
            m.dataset.category = el.category; 
            m.dataset.group = el.group || ''; 
            m.dataset.name = (el.name||'').toLowerCase();
            m.dataset.id = el.id;
            m.style.left = (el.x / bgWidth * 100) + '%';
            m.style.top = (el.y / bgHeight * 100) + '%';
            m.style.color = el.color;
            let base = 40, size = Math.min(80, base * (el.size/100));
            m.style.width = size+'px'; m.style.height = size+'px';
            if(el.mapImage) {
                if (el.mapImage.startsWith('http')) m.innerHTML = '<img src="'+el.mapImage+'">';
                else m.innerHTML = '<i class="'+el.mapImage+'" style="font-size:'+(size*0.6)+'px;"></i>';
            } else {
                m.innerHTML = '<i class="fas fa-'+(el.icon||'map-marker-alt')+'" style="font-size:'+(size*0.6)+'px;"></i>';
            }
            m.title = el.name;
            const markerClickHandler = (e)=> { e.preventDefault(); e.stopPropagation(); showTooltip(el, e.target); };
            m.addEventListener('mouseenter', (e) => showHoverTooltip(el.name, e.target));
            m.addEventListener('mouseleave', () => hideHoverTooltip());
            m.addEventListener('click', markerClickHandler);
            m.addEventListener('touchend', markerClickHandler);
            document.getElementById('map').appendChild(m);
        }
        function createZone(el){
            let z = document.createElement('div');
            z.className = 'map-zone filter-'+el.category;
            z.dataset.category = el.category; 
            z.dataset.group = el.group||''; 
            z.dataset.name = (el.name||'').toLowerCase();
            z.style.left = (el.x / bgWidth * 100) + '%';
            z.style.top = (el.y / bgHeight * 100) + '%';
            if(el.shape==='circle') {
                let maxDim = Math.max(el.width, el.height);
                z.style.width = (maxDim / bgWidth * 100) + '%';
                z.style.height = (maxDim / bgHeight * 100) + '%';
            } else {
                z.style.width = (el.width / bgWidth * 100) + '%';
                z.style.height = (el.height / bgHeight * 100) + '%';
            }
            z.style.borderColor = el.color;
            z.style.borderStyle = el.borderStyle;
            z.style.opacity = el.opacity/100;
            let scale = Math.min(2, Math.max(0.3, el.size/100));
            z.style.transform = 'scale('+scale+')';
            if(el.mapImage) {
                if (el.mapImage.startsWith('http')) z.style.backgroundImage = 'url("'+el.mapImage+'")';
            } else {
                z.style.backgroundColor = el.color + Math.round(el.opacity*2.55).toString(16).padStart(2,'0');
            }
            if(el.shape==='circle'||el.shape==='ellipse') z.style.borderRadius='50%';
            if(el.shape==='polygon') z.style.clipPath='polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)';
            z.title = el.name;
            const zoneClickHandler = (e)=> { e.preventDefault(); e.stopPropagation(); showTooltip(el, e.target); };
            z.addEventListener('mouseenter', (e) => showHoverTooltip(el.name, e.target));
            z.addEventListener('mouseleave', () => hideHoverTooltip());
            z.addEventListener('click', zoneClickHandler);
            z.addEventListener('touchend', zoneClickHandler);
            document.getElementById('map').appendChild(z);
        }

        function zoomAtPoint(newZoom, clientX, clientY) {
            const container = document.getElementById('map-container');
            const rect = container.getBoundingClientRect();
            const sx = clientX - rect.left;
            const sy = clientY - rect.top;
            const mapX = sx / zoom - offsetX;
            const mapY = sy / zoom - offsetY;
            newZoom = Math.min(maxZoom, Math.max(minZoom, newZoom));
            offsetX = sx / newZoom - mapX;
            offsetY = sy / newZoom - mapY;
            zoom = newZoom;
            setMapTransform(zoom, offsetX, offsetY);
        }

                function zoomIn() {
            const container = document.getElementById('map-container');
            const rect = container.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            zoomAtPoint(zoom * 1.1, centerX, centerY);
        }

        function zoomOut() {
            const container = document.getElementById('map-container');
            const rect = container.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            zoomAtPoint(zoom * 0.9, centerX, centerY);
        }

        function setMapTransform(zoom, offsetX, offsetY) {
            const map = document.getElementById('map');
            map.style.transition = 'none';               
            map.style.transform = `scale(${zoom}) translate(${offsetX}px, ${offsetY}px)`;
            map.offsetHeight;                           
            map.style.transition = 'transform 0.1s ease-out';
        }

        function shouldStartPan(e) {
            return !e.target.closest('.map-marker, .map-zone, .control-btn, .filter-panel, .filter-panel *');
        }

        const PAN_BOOST_FACTOR = 2.5;
        function getPanSpeedFactor(zoomLevel) {
            if (zoomLevel <= 1) {
                return 1 + PAN_BOOST_FACTOR * (1 - zoomLevel);
            }
            return 1;
        }

        function setupTouchPan() {
            const map = document.getElementById('map');

            document.addEventListener('mousedown', (e) => {
                if (shouldStartPan(e)) {
                    isDragging = true;
                    dragStart = {
                        mouseX: e.clientX,
                        mouseY: e.clientY,
                        offsetX: offsetX,
                        offsetY: offsetY
                    };
                    map.style.cursor = 'grabbing';
                    e.preventDefault();
                }
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const factor = getPanSpeedFactor(zoom);
                    const deltaX = e.clientX - dragStart.mouseX;
                    const deltaY = e.clientY - dragStart.mouseY;
                    offsetX = dragStart.offsetX + deltaX * factor;
                    offsetY = dragStart.offsetY + deltaY * factor;
                    map.style.transform = `scale(${zoom}) translate(${offsetX}px, ${offsetY}px)`;
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                map.style.cursor = 'grab';
            });

            map.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                zoomAtPoint(zoom * delta, e.clientX, e.clientY);
            });

            let touchDist = 0, startZoom = 1;

            document.addEventListener('touchstart', (e) => {
                if (e.touches.length === 2) {
                    touchDist = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );
                    startZoom = zoom;
                } else if (e.touches.length === 1 && shouldStartPan(e)) {
                    isDragging = true;
                    dragStart = {
                        mouseX: e.touches[0].clientX,
                        mouseY: e.touches[0].clientY,
                        offsetX: offsetX,
                        offsetY: offsetY
                    };
                    e.preventDefault();
                }
            }, { passive: false });

            document.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    const d = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );
                    const scale = d / touchDist;
                    const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
                    const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
                    zoomAtPoint(startZoom * scale, centerX, centerY);
                } else if (e.touches.length === 1 && isDragging) {
                    e.preventDefault();
                    const factor = getPanSpeedFactor(zoom);
                    const deltaX = e.touches[0].clientX - dragStart.mouseX;
                    const deltaY = e.touches[0].clientY - dragStart.mouseY;
                    offsetX = dragStart.offsetX + deltaX * factor;
                    offsetY = dragStart.offsetY + deltaY * factor;
                    map.style.transform = `scale(${zoom}) translate(${offsetX}px, ${offsetY}px)`;
                }
            }, { passive: false });

            document.addEventListener('touchend', () => {
                isDragging = false;
            });
        }

        function searchElements(){
            let term = document.getElementById('filter-search').value.toLowerCase().trim();
            let allMapItems = document.querySelectorAll('.map-marker, .map-zone');
            
            allMapItems.forEach(el => {
                let name = el.dataset.name || '';
                let cat = el.dataset.category || '';
                let grp = el.dataset.group || '';
                let match = term === '' || name.includes(term) || cat.toLowerCase().includes(term) || grp.toLowerCase().includes(term);
                el.classList.toggle('search-match', match);
                el.classList.toggle('search-mismatch', !match && term!=='');
                el.classList.toggle('map-element-hidden', !match && term!=='');
            });

            let categoryItems = document.querySelectorAll('.filter-category-item');
            categoryItems.forEach(catItem => {
                let catName = catItem.dataset.category;
                let visibleCount = 0;
                allMapItems.forEach(el => {
                    if (el.dataset.category === catName && el.classList.contains('search-match')) visibleCount++;
                });
                if (term !== '' && visibleCount === 0) {
                    catItem.classList.add('filter-hidden');
                } else {
                    catItem.classList.remove('filter-hidden');
                }
            });

            let groupHeaders = document.querySelectorAll('.filter-group-header');
            groupHeaders.forEach(header => {
                let group = header.dataset.group;
                let visibleCategories = document.querySelectorAll(`.filter-category-item[data-group="${group}"]:not(.filter-hidden)`);
                if (term !== '' && visibleCategories.length === 0) {
                    header.classList.add('filter-hidden');
                    let contentId = 'group-' + group.replace(/\s+/g,'-');
                    let content = document.getElementById(contentId);
                    if(content) content.classList.add('filter-hidden');
                } else {
                    header.classList.remove('filter-hidden');
                    let contentId = 'group-' + group.replace(/\s+/g,'-');
                    let content = document.getElementById(contentId);
                    if(content) content.classList.remove('filter-hidden');
                }
            });
        }

        function toggleGroupVisibility(group){
            let sw = document.querySelector(`[data-group="${group}"] .group-toggle-switch`);
            let isOn = sw.classList.contains('on');
            groupVisibility[group] = !isOn;
            let elements = document.querySelectorAll(`.map-marker[data-group="${group}"], .map-zone[data-group="${group}"]`);
            let categoryItems = document.querySelectorAll(`.filter-category-item[data-group="${group}"]`);
            if(groupVisibility[group]) {
                sw.classList.add('on');
                elements.forEach(el => el.classList.remove('map-element-hidden'));
                categoryItems.forEach(item => item.classList.add('active'));
            } else {
                sw.classList.remove('on');
                elements.forEach(el => el.classList.add('map-element-hidden'));
                categoryItems.forEach(item => item.classList.remove('active'));
            }
        }

        function toggleGroup(group){
            let c = document.getElementById('group-'+group.replace(/\s+/g,'-'));
            c.classList.toggle('collapsed');
        }
        function toggleCategory(cat){
            let vis = !document.querySelector(`.map-marker[data-category="${cat}"], .map-zone[data-category="${cat}"]`)?.classList.contains('map-element-hidden');
            document.querySelectorAll(`.map-marker[data-category="${cat}"], .map-zone[data-category="${cat}"]`).forEach(el => el.classList.toggle('map-element-hidden', vis));
            document.querySelectorAll(`.filter-category-item[data-category="${cat}"]`).forEach(item => {
                item.classList.toggle('active', !vis);
            });
        }
        function showAllMarkers(){
            document.querySelectorAll('.map-marker').forEach(m=>m.classList.remove('map-element-hidden'));
            document.querySelectorAll('.filter-category-item').forEach(item => {
                let cat = item.dataset.category;
                let hasMarkers = document.querySelectorAll(`.map-marker[data-category="${cat}"]`).length > 0;
                if (hasMarkers) item.classList.add('active');
            });
        }
        function hideAllMarkers(){
            document.querySelectorAll('.map-marker').forEach(m=>m.classList.add('map-element-hidden'));
            document.querySelectorAll('.filter-category-item').forEach(item => {
                let cat = item.dataset.category;
                let hasZones = document.querySelectorAll(`.map-zone[data-category="${cat}"]`).length > 0;
                if (!hasZones) item.classList.remove('active');
            });
        }
        function showAllZones(){
            document.querySelectorAll('.map-zone').forEach(z=>z.classList.remove('map-element-hidden'));
            document.querySelectorAll('.filter-category-item').forEach(item => {
                let cat = item.dataset.category;
                let hasZones = document.querySelectorAll(`.map-zone[data-category="${cat}"]`).length > 0;
                if (hasZones) item.classList.add('active');
            });
        }
        function hideAllZones(){
            document.querySelectorAll('.map-zone').forEach(z=>z.classList.add('map-element-hidden'));
            document.querySelectorAll('.filter-category-item').forEach(item => {
                let cat = item.dataset.category;
                let hasMarkers = document.querySelectorAll(`.map-marker[data-category="${cat}"]`).length > 0;
                if (!hasMarkers) item.classList.remove('active');
            });
        }
        function toggleFilters(){ 
            let p = document.querySelector('.filter-panel');
            p.classList.toggle('collapsed');
            p.querySelector('.control-btn i').className = p.classList.contains('collapsed') ? 'fas fa-chevron-down' : 'fas fa-chevron-up';
        }

        function showTooltip(el, target){
            let t = document.getElementById('tooltip');
            let completed = completedMarkers[el.id] || false;
            let compHtml = el.type==='marker' ? `<div class="completion-checkbox"><input type="checkbox" id="chk-${el.id}" ${completed?'checked':''} onchange="toggleMarkerCompletion(${el.id},this.checked)"><label style="color:#e6e6e6;">Mark completed</label></div>` : '';
            let tooltipImage = '';
            if (el.tooltipImage) {
                if (el.tooltipImage.startsWith('http')) tooltipImage = '<img src="'+el.tooltipImage+'" class="tooltip-img">';
                else tooltipImage = '<i class="'+el.tooltipImage+'" style="font-size:48px; display:block; margin:10px auto; color:'+el.color+'"></i>';
            }
            t.innerHTML = `
                <button class="tooltip-close" onclick="closeTooltip()" ontouchend="closeTooltip();event.preventDefault();">&times;</button>
                <h3 style="color:${el.color};">${el.name}</h3>
                ${tooltipImage}
                ${'<p>' + el.description + '</p>' || ''}
                ${compHtml}
                <div style="margin-top:10px; color:#94a3b8;">Category: ${el.category} ${el.group?'Â· Group: '+el.group:''}</div>
            `;
            
            t.style.display = 'block';
            t.style.opacity = '0';
            t.classList.remove('fade-out');
            t.classList.add('fade-in');
            t.style.left = '0px';
            t.style.top = '0px';
            t.style.transform = 'translate(0, 0)';
            
            let targetRect = target.getBoundingClientRect();
            let tooltipRect = t.getBoundingClientRect();
            let winWidth = window.innerWidth;
            let winHeight = window.innerHeight;
            let padding = 15;
            let tooltip = { width: tooltipRect.width || 340, height: tooltipRect.height || 200 };
            
            let spaceAbove = targetRect.top - padding;
            let spaceBelow = winHeight - targetRect.bottom - padding;
            let spaceLeft = targetRect.left - padding;
            let spaceRight = winWidth - targetRect.right - padding;
            
            let posY, transformY;
            if (tooltip.height < spaceAbove) {
                posY = targetRect.top - 15;
                transformY = '-100%';
            } else if (tooltip.height < spaceBelow) {
                posY = targetRect.bottom + 15;
                transformY = '0%';
            } else {
                posY = (winHeight - tooltip.height) / 2;
                transformY = '0%';
            }
            
            let targetCenterX = targetRect.left + targetRect.width / 2;
            let posX = targetCenterX;
            let transformX = '-50%';
            
            let estimatedLeft = targetCenterX - (tooltip.width / 2);
            let estimatedRight = targetCenterX + (tooltip.width / 2);
            
            if (estimatedLeft < padding) {
                posX = padding + (tooltip.width / 2);
                transformX = '-50%';
            } else if (estimatedRight > winWidth - padding) {
                posX = winWidth - padding - (tooltip.width / 2);
                transformX = '-50%';
            }
            
            t.style.left = posX + 'px';
            t.style.top = posY + 'px';
            t.style.transform = `translate(${transformX}, ${transformY})`;
            hideHoverTooltip();
        }
            
        function closeTooltip(){
            let t = document.getElementById('tooltip');
            t.classList.add('fade-out');
            t.classList.remove('fade-in');
            setTimeout(()=>{
                t.style.display = 'none';
                t.classList.remove('fade-out');
            }, 300);
        }

        function showHoverTooltip(name, target){
            let ht = document.getElementById('hover-tooltip');
            ht.textContent = name;
            ht.style.display = 'block';
            let rect = target.getBoundingClientRect();
            let left = rect.left + rect.width / 2;
            let top = rect.top - 10;
            ht.style.left = left + 'px';
            ht.style.top = top + 'px';
            ht.style.transform = 'translate(-50%, -100%)';
        }

        function hideHoverTooltip(){
            document.getElementById('hover-tooltip').style.display = 'none';
        }

        function toggleMarkerCompletion(id, checked){
            completedMarkers[id] = checked;
            localStorage.setItem('mapforge_completed_markers', JSON.stringify(completedMarkers));
            document.querySelector('[data-id="'+id+'"]')?.classList.toggle('completed', checked);
        }

        function resetView(){
            centerMapOnLoad();
        }
        function centerMapOnLoad(){
            const container = document.getElementById('map-wrapper');
            const map = document.getElementById('map');
            zoom = 0.5;
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            const mapWidth = bgWidth * zoom;
            const mapHeight = bgHeight * zoom;
            offsetX = 200;
            offsetY = 50;
            map.style.transform = `scale(${zoom}) translate(${offsetX}px, ${offsetY}px)`;
        }
    </script>
</body>
</html>
